# 0.4.3 Philosophy Alignment Review

## Summary

This review covers the unreleased `0.4.3` changelog section only.

Overall conclusion: the `0.4.3` feature set is aligned with Mini Diarium's philosophy. The main problem was not product direction, but doctrine drift in supporting documentation. Most remediation is therefore documentation alignment rather than feature rollback.

## Review Criteria

Each item below is evaluated against the six principles in [PHILOSOPHY.md](../../PHILOSOPHY.md):

1. Small and Extensible Core
2. Boring Security
3. Testing Pyramid
4. Easy In, Easy Out
5. Focused Scope
6. Simple is Good

Verdicts:

- `Pass`
- `Pass with caveat`
- `Fail`

## Added

### Expanded Rich Text Toolbar

**What changed**

The editor toolbar gained heading selection, underline, strikethrough, blockquote, inline code, and horizontal rule controls. Markdown export also now preserves strikethrough, blockquotes, inline code, fenced code blocks, and horizontal rules.

**Evaluation**

- **Core vs. extension:** Pass. Rich-text authoring is part of the core journaling workflow, not a side integration.
- **Security impact:** Pass. No network access, cryptography, or new privileged capability is involved.
- **Testing:** Pass. Export semantics are covered in `src-tauri/src/export/markdown.rs` tests; the editor surface itself remains a frontend test gap, but not a blocker for philosophy alignment.
- **Portability:** Pass with caveat. JSON export remains the structural, lossless path. Markdown export is intentionally best-effort. Underline has no native Markdown representation, so `<u>` is flattened to plain text.
- **Scope:** Pass. These are still writing tools for a journal, not a move into publishing or document-suite territory.
- **Simplicity:** Pass with caveat. The toolbar is meaningfully larger, but still bounded and justified by the core use case.

**Verdict**

`Pass with caveat`

**Required remediation**

- Document explicitly that Markdown export is semantic best-effort, not lossless for every HTML mark.
- Document underline as an accepted portability caveat rather than an unsupported bug.

### Configurable Auto-Lock Timeout

**What changed**

Users can enable idle-based auto-lock with a configurable timeout from `1` to `999` seconds, stored in `localStorage`.

**Evaluation**

- **Core vs. extension:** Pass. Session hardening belongs in the core of an encrypted journal.
- **Security impact:** Pass. This directly strengthens the local threat model while unlocked.
- **Testing:** Pass. Deterministic timeout logic is testable and bounded.
- **Portability:** Pass. No import/export or schema risk.
- **Scope:** Pass. Security hardening is in scope.
- **Simplicity:** Pass with caveat. It adds state and event handling, but this is justified complexity in service of Principle 2.

**Verdict**

`Pass`

**Required remediation**

- None beyond current docs alignment.

### Auto-Lock on macOS Screen Lock

**What changed**

The diary now auto-locks on macOS display sleep and system sleep, matching the existing Windows behavior.

**Evaluation**

- **Core vs. extension:** Pass. OS session-boundary locking is core security behavior.
- **Security impact:** Pass. It reduces exposure when a device leaves the active session.
- **Testing:** Pass with caveat. Platform-specific hooks are inherently harder to test, but the behavior is deterministic and security-motivated.
- **Portability:** Pass. No data-format impact.
- **Scope:** Pass. This is parity/security work, not product expansion.
- **Simplicity:** Pass with caveat. Platform-specific code is acceptable here as justified complexity.

**Verdict**

`Pass`

**Required remediation**

- None beyond current docs alignment.

### Multiple Entries Per Day

**What changed**

A date can now contain multiple independent entries. The editor shows an entry navigation bar when a day has more than one entry, and users can create additional entries for the selected date.

**Evaluation**

- **Core vs. extension:** Pass. This changes the primary journaling model and belongs in core.
- **Security impact:** Pass. No security model regression is introduced.
- **Testing:** Pass. The feature has direct frontend and backend coverage surfaces and already drove updates in entry, stats, and export behavior.
- **Portability:** Pass. The feature required explicit export and import contract updates rather than proprietary storage.
- **Scope:** Pass. This deepens journaling rather than broadening into a different product category.
- **Simplicity:** Pass with caveat. It adds state, navigation, and schema complexity, but it removes an actual journaling limitation.

**Verdict**

`Pass`

**Required remediation**

- Update docs that still describe one-entry-per-day behavior.

### Entry Identity

**What changed**

Entries now have stable integer IDs and save/delete/export operations target entries by ID rather than by date.

**Evaluation**

- **Core vs. extension:** Pass. Stable identity is a necessary consequence of multiple entries per day.
- **Security impact:** Pass. No new threat surface.
- **Testing:** Pass. ID-based behavior is straightforward to test at command/export level.
- **Portability:** Pass. IDs improve structural clarity in exports rather than creating lock-in.
- **Scope:** Pass. This is internal correctness work for the journaling core.
- **Simplicity:** Pass. The model is simpler and more correct than overloading `date` as identity.

**Verdict**

`Pass`

**Required remediation**

- Update docs that still describe date-as-identity behavior.

## Changed

### Schema v5

**What changed**

The schema moved from one-entry-per-day to `id` plus indexed `date`, with automatic migration on upgrade.

**Evaluation**

- **Core vs. extension:** Pass. This is foundational core data modeling.
- **Security impact:** Pass. Encryption and offline guarantees remain unchanged.
- **Testing:** Pass. Schema migrations and version assertions are testable and already covered.
- **Portability:** Pass. The schema remains documented and open.
- **Scope:** Pass. This is required infrastructure for the core writing model.
- **Simplicity:** Pass with caveat. Migrations add complexity, but the resulting model is clearer and more durable.

**Verdict**

`Pass`

### Import No Longer Merges Same-Date Entries

**What changed**

Imports now always create new entries instead of merging same-date content into existing entries.

**Evaluation**

- **Core vs. extension:** Pass. Import behavior is core to portability.
- **Security impact:** Pass. No new security assumptions.
- **Testing:** Pass. The behavior is deterministic and easier to reason about than merge heuristics.
- **Portability:** Pass. This is more honest and structurally faithful to source data than implicit same-date merging.
- **Scope:** Pass. Import remains a focused journaling feature.
- **Simplicity:** Pass. The removal of merge heuristics is simpler than trying to infer user intent.

**Verdict**

`Pass`

**Required remediation**

- Remove remaining docs language that still promises merge conflict resolution.

### JSON Export Format Changed to an Array

**What changed**

JSON export now emits an `entries` array containing entry IDs rather than a date-keyed object.

**Evaluation**

- **Core vs. extension:** Pass. Export structure is core portability work.
- **Security impact:** Pass. No security regression.
- **Testing:** Pass. The format is precise and testable.
- **Portability:** Pass. This improves portability because it can represent multiple entries for the same date without lossy collapsing.
- **Scope:** Pass. Open export is explicitly part of the philosophy.
- **Simplicity:** Pass. The array shape is more direct for the current data model.

**Verdict**

`Pass`

### Markdown Export Groups Multiple Entries Per Day

**What changed**

Markdown export now nests multiple entries for a day under the day's heading using sub-headings.

**Evaluation**

- **Core vs. extension:** Pass. Markdown export is a core portability feature.
- **Security impact:** Pass. No security change.
- **Testing:** Pass. Grouping is deterministic and backed by export tests.
- **Portability:** Pass with caveat. Markdown stays human-readable, but it is not the lossless structural format; JSON is.
- **Scope:** Pass. This keeps export aligned with the journaling model.
- **Simplicity:** Pass. The output is understandable and consistent.

**Verdict**

`Pass`

**Required remediation**

- Clarify in docs that JSON is the structural export path and Markdown is a readable best-effort conversion.

## Fixed

### Streak Calculation Counts Distinct Days

**What changed**

Statistics now deduplicate dates before computing streaks.

**Evaluation**

- **Core vs. extension:** Pass. Statistics are part of the existing journaling scope.
- **Security impact:** Pass.
- **Testing:** Pass. The distinct-day rule is deterministic and easy to verify.
- **Portability:** Pass. No import/export impact.
- **Scope:** Pass. This corrects behavior rather than expanding scope.
- **Simplicity:** Pass. The rule is simpler and matches user expectation.

**Verdict**

`Pass`

## Overall Conclusion

`0.4.3` is philosophically aligned.

The only meaningful caveat is export semantics for rich-text formatting that Markdown cannot represent natively, especially underline. That is acceptable because Mini Diarium already provides:

- a documented, open JSON export path for structural fidelity
- human-readable Markdown export as best-effort conversion
- no proprietary or hidden format dependency

## Required Follow-Up

1. Realign `PHILOSOPHY.md` with the current import/export and schema model.
2. Remove stale “merge conflict resolution” and “one entry per day” claims from user-facing docs.
3. Clarify the JSON-versus-Markdown portability distinction in current docs.
