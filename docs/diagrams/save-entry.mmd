%%{init: {"theme":"base","themeVariables":{
  "fontFamily":"Inter, system-ui, sans-serif",
  "primaryColor":"#E3F2FD",
  "primaryTextColor":"#0F172A",
  "primaryBorderColor":"#90CAF9",
  "lineColor":"#90A4AE"
}}}%%
flowchart TB

  classDef ui fill:#E3F2FD,stroke:#1565C0,stroke-width:2px,color:#0F172A;
  classDef backend fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,color:#0F172A;
  classDef data fill:#FFF3E0,stroke:#E65100,stroke-width:2px,color:#0F172A;
  classDef decision fill:#FFFDE7,stroke:#CA8A04,stroke-width:2px,color:#0F172A;

  DATE["Selected date"]
  LOAD["get_entries_for_date(date)"]
  STATE["EditorPanel local state<br/>(dayEntries, currentIndex,<br/>pendingEntryId, title, content)"]
  EDITOR["TipTap + Title Editor"]
  CHECK{"Has active<br/>entry id?"}
  CREATE["create_entry(date)"]
  SAVE["save_entry(id, title, text)"]
  EMPTY{"Title + content<br/>blank?"}
  DELETE["delete_entry_if_empty(id, title, text)"]
  DATES["get_all_entry_dates()<br/>refresh calendar indicators"]
  ENC["DB query layer encrypts title/text<br/>AES-256-GCM with master key"]
  DB1["SQLite entries<br/>(id-based, multiple entries per date)"]

  DATE --> LOAD --> STATE --> EDITOR --> CHECK
  CHECK -- Yes --> SAVE
  CHECK -- No --> CREATE --> LOAD
  SAVE --> EMPTY
  EMPTY -- No --> ENC --> DB1 --> DATES
  EMPTY -- Yes --> DELETE --> DATES
  CREATE --> DATES

  class DATE,LOAD,STATE,EDITOR,DATES ui;
  class CREATE,SAVE,DELETE,ENC backend;
  class DB1 data;
  class CHECK,EMPTY decision;
